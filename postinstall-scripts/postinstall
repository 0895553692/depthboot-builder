#!/usr/bin/env python3

import os
import sys
import subprocess as sp
from os import system as bash

if __name__ == "__main__":
    # Elevate script to root
    if os.geteuid() != 0:
        args = ['sudo', sys.executable] + sys.argv + [os.environ]
        os.execlpe('sudo', *args)
    # read root partition mount
    root_part = sp.run("mount | grep ' / ' | cut -d' ' -f 1", shell=True, capture_output=True).stdout.decode(
        "utf-8").strip()
    root_part = root_part[:len(root_part) - 1]  # get device "name"
    bash(f"growpart {root_part} 2")
    # delete systemd service
    bash("systemctl disable postinstall.service")
    os.remove("/etc/systemd/system/postinstall.service")
